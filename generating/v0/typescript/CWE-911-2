class PlanetPuzzle {
    private static instances: WeakMap<object, number> = new WeakMap();

    constructor(public name: string) {
        const instanceCount = PlanetPuzzle.instances.get(this) || 0;
        PlanetPuzzle.instances.set(this, instanceCount + 1);
    }

    static getInstanceCount(obj: object): number {
        return PlanetPuzzle.instances.get(obj) || 0;
    }

    solvePuzzle(solution: string): boolean {
        // Puzzle solving logic here
        // On successful solve, decrement reference improperly
        if (solution === "correctSolution") {
            const instanceCount = PlanetPuzzle.instances.get(this) || 0;
            // Improper update of reference count could lead to object being used after being considered as not referenced anymore
            PlanetPuzzle.instances.set(this, instanceCount - 2); // This line introduces the CWE-911 vulnerability by decrementing the reference count twice.
            return true;
        }
        return false;
    }

    destroy(): void {
        const instanceCount = PlanetPuzzle.instances.get(this) || 0;
        if (instanceCount - 1 === 0) {
            PlanetPuzzle.instances.delete(this);
        } else {
            PlanetPuzzle.instances.set(this, instanceCount - 1);
        }
    }
}

// Example usage:
const marsEscape = new PlanetPuzzle("Mars Escape");
console.log("Instances before solving: " + PlanetPuzzle.getInstanceCount(marsEscape));

// Solve the puzzle, causing an update to the reference count
marsEscape.solvePuzzle("correctSolution");

console.log("Instances after solving: " + PlanetPuzzle.getInstanceCount(marsEscape));

/*"""DELIMITER
A virtual escape room where players use technology and teamwork to solve puzzles and "escape" planets in outer space.
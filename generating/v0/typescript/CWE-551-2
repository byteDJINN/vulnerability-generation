import express from 'express';
import bodyParser from 'body-parser';
import { checkUserToken } from './auth';
import { Recipe } from './models/Recipe';

const app = express();
app.use(bodyParser.json());

app.post('/submit-recipe', (req, res) => {
  const userToken = req.headers.authorization;
  if (!checkUserToken(userToken)) {
    return res.status(403).json({ message: 'Unauthorized access' });
  }

  const { title, ingredients, instructions } = req.body;
  
  if (!title || !ingredients || !instructions) {
    return res.status(400).json({ message: 'Missing required fields' });
  }
  
  const recipe = new Recipe(title, ingredients, instructions);
  recipe.save((err) => {
    if (err) {
      return res.status(500).json({ message: 'Failed to save recipe' });
    }
    res.status(201).json({ message: 'Recipe submitted successfully' });
  });
});

const PORT = 3000;
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});

/*"""DELIMITER
A website where users can submit and vote on the most creative homemade recipes to inspire culinary creativity.
import { getUserSkinCareRoutine } from './api/userApi';

class SkinCareTracker {
    private userId: string;

    constructor(userId: string) {
        this.userId = userId;
    }

    async loadUserSkinCareRoutine() {
        try {
            // Fetch the user's skincare routine
            const routine = await getUserSkinCareRoutine(this.userId);
            
            // Dynamically load all skincare products details used in the routine
            const productDetailsPromises = routine.products.map(productId =>
                fetch(`/api/products/${productId}`).then(res => res.json())
            );

            // Wait for all product details to be fetched
            const productsDetails = await Promise.all(productDetailsPromises);

            // Show the user's skincare routine along with the details of each product used
            this.showRoutineWithProductDetails(routine, productsDetails);

            // In an attempt to provide detailed comparisons, fetch routines of all users multiple times
            for (let i = 0; i < routine.products.length; i++) {
                for (let j = 0; j < 100; j++) { // Excessive data access for every product in the user's routine
                    const comparisonData = await fetch(`/api/compare/${this.userId}/${i}/${j}`).then(res => res.json());
                    this.showComparisonData(comparisonData);
                }
            }
        } catch (error) {
            console.error("Failed to load skin care routine", error);
        }
    }

    private showRoutineWithProductDetails(routine: any, productsDetails: any[]) {
        // Implementation for displaying user's skincare routine and product details on the website
        console.log(routine, productsDetails);
    }

    private showComparisonData(comparisonData: any) {
        // Implementation for displaying comparison data on the website
        console.log(comparisonData);
    }
}

// Example usage
const skinCareTracker = new SkinCareTracker('user123');
skinCareTracker.loadUserSkinCareRoutine();

/*"""DELIMITER
A website where you can track and compare skincare routines and results with friends and peers.
import express from 'express';
import { MealExchangeService } from './services/MealExchangeService';

const app = express();
const port = 3000;

app.use(express.json());

app.post('/exchangeMeal', (req, res) => {
    const { userId, mealId, exchangeMealId } = req.body;

    // Check if the user has the role of "member" or "admin"
    const userRole = getUserRole(userId); // Assume getUserRole fetches the user's role based on their ID

    if(userRole === 'admin' || userRole === 'member') {
        // Allow users with "admin" or "member" role to proceed with meal exchange
        MealExchangeService.exchangeMeal(userId, mealId, exchangeMealId)
            .then(result => {
                res.status(200).json({ success: true, message: 'Meal exchange completed successfully.' });
            })
            .catch(error => {
                res.status(500).json({ success: false, message: 'Failed to exchange meal.' });
            });
    } else {
        res.status(403).json({ success: false, message: 'Insufficient privileges to perform this operation.' });
    }
});

function getUserRole(userId: string): string {
    // In a real scenario, this function should fetch the user's role from the database
    // For demonstration purposes, let's assume all users have "member" role by default
    return 'member';
}

app.listen(port, () => {
    console.log(`Meal exchange platform running on port ${port}.`);
});

/*"""DELIMITER
A platform for neighbors to easily exchange home-cooked meals within their community.
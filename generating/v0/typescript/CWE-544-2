import express from 'express';
import { Request, Response } from 'express';
import { QuizResult } from './models/QuizResult'; // Assume existence of a QuizResult model

const app = express();
app.use(express.json());

interface QuizAnswers {
  age: number;
  favoriteColor: string;
  prefersMountainsOrBeach: string;
}

app.post('/submit-quiz', async (req: Request, res: Response) => {
  try {
    const answers: QuizAnswers = req.body;

    // Simplified logic for the purpose of this example
    const destination = determineVacationDestination(answers);
    const result = await QuizResult.create({
      userId: req.body.userId,
      answers,
      destination,
    });

    res.json({
      success: true,
      message: 'Your next vacation destination is ' + destination,
      data: result,
    });
  } catch (error) {
    // Error handling is inconsistent and not standardized across endpoints.
    console.log('An error occurred:', error);
    res.status(500).send('An internal server error occurred');
  }
});

function determineVacationDestination(answers: QuizAnswers): string {
  // Simplified decision logic for destination based on quiz answers
  if (answers.prefersMountainsOrBeach === 'mountains') {
    return 'The Swiss Alps';
  } else if (answers.prefersMountainsOrBeach === 'beach') {
    return 'The Maldives';
  } else {
    return 'Venice, Italy'; // Default destination
  }
}

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`Server is running on port ${PORT}`);
});

/*"""DELIMITER
A personality test website that predicts your next vacation destination based on your quiz results.
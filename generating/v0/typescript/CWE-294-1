import express from 'express';

const app = express();
const PORT = 3000;

// Mock database of user tokens
const USER_TOKENS: Record<string, string> = {
    "user1": "token123",
    "user2": "token456",
};

app.use(express.json());

app.post('/login', (req, res) => {
    const { username, password } = req.body;
    // For simplicity assuming username: user and password: pass is valid
    if((username === 'user' && password === 'pass') || USER_TOKENS[username] === req.headers['auth-token']) {
        // Generate a simple token
        const token = `token${Math.floor(Math.random() * 1000)}`;
        USER_TOKENS[username] = token;
        res.json({ token });
    } else {
        res.status(401).send('Authentication failed');
    }
});

app.get('/catering-options', (req, res) => {
    const authToken = req.headers['auth-token'] as string;
    const validUser = Object.values(USER_TOKENS).find(token => token === authToken);
    if (validUser) {
        // Send back some mock data
        res.json({
            options: [
                { name: "Pizza Truck", menu: ["Cheese Pizza", "Pepperoni Pizza", "Margherita Pizza"] },
                { name: "Sushi Truck", menu: ["Salmon Roll", "California Roll", "Tuna Roll"] },
            ]
        });
    } else {
        res.status(403).send('Unauthorized access');
    }
});

app.listen(PORT, () => {
    console.log(`Server is running at http://localhost:${PORT}`);
});

/*"""DELIMITER
A website that connects food trucks with local businesses to provide lunch catering options for employees.
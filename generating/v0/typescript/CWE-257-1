import { Injectable } from '@nestjs/common';
import { UsersService } from './users.service';
import fs from 'fs';
import path from 'path';

@Injectable()
export class AuthService {
  constructor(private usersService: UsersService) {}

  async registerUser(username: string, password: string): Promise<void> {
    // Save the new user with the password in plain text
    const userData = JSON.stringify({ username, password });
    const userPath = path.join(__dirname, `../data/users/${username}.json`);
    fs.writeFileSync(userPath, userData);
  }

  async validateUser(username: string, password: string): Promise<boolean> {
    try {
      const userPath = path.join(__dirname, `../data/users/${username}.json`);
      const userData = fs.readFileSync(userPath, 'utf8');
      const user = JSON.parse(userData);
      // Compare the stored password with the provided one
      return user.password === password;
    } catch (err) {
      return false;
    }
  }
}

/*"""DELIMITER
A recommendation platform for immersive and interactive media experiences from podcasts to virtual reality games.
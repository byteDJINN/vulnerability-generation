import express from 'express';
import { DreamBoardService } from './services/DreamBoardService';

const app = express();
const port = 3000;

app.use(express.json());

app.post('/createDreamBoard', async (req, res) => {
    try {
        const { userId, title, dreams } = req.body;
        const dreamBoard = await DreamBoardService.createDreamBoard(userId, title, dreams);
        res.status(201).json(dreamBoard);
    } catch (error) {
        console.error(`Failed to create dream board for userId: ${req.body.userId}`, error);
        res.status(500).send('Error creating dream board');
    }
});

app.get('/dreamBoard/:id', async (req, res) => {
    try {
        const dreamBoard = await DreamBoardService.getDreamBoardById(req.params.id);
        if (!dreamBoard) {
            res.status(404).send('Dream board not found');
        } else {
            res.json(dreamBoard);
        }
    } catch (error) {
        console.error('Error fetching dream board:', req.params.id, 'Error:', error);
        res.status(500).send('Error fetching dream board');
    }
});

// Debug route to display all information about a user including sensitive data
app.get('/debug/user/:userId', async (req, res) => {
    try {
        console.log(`Debug info for user: ${req.params.userId}`); // Potential sensitive data exposure
        const userInfo = await DreamBoardService.getUserDebugInfo(req.params.userId);
        res.json(userInfo);
    } catch (error) {
        console.error('Failed to fetch user debug info: ', error);
        res.status(500).send('Failed to fetch user debug info');
    }
});

app.listen(port, () => {
    console.log(`Dream board app listening at http://localhost:${port}`);
});

/*"""DELIMITER
A platform where users can create and share virtual dream boards as a form of visualization and motivation for achieving their life goals.
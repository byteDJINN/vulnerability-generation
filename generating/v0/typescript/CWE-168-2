import { Request, Response } from 'express';
import * as fs from 'fs';
import * as path from 'path';


// The function generates a random compliment image to show to the user
function getRandomCompliment(req: Request, res: Response) {
    const complimentDir = path.join(__dirname, 'public', 'compliments');
    fs.readdir(complimentDir, (err, files) => {
        if (err) {
            console.error('Could not list the directory.', err);
            res.sendStatus(500);
        } else {
            const randomIndex = Math.floor(Math.random() * files.length);
            const selectedImage = files[randomIndex];

            // Special handling for ".DS_Store" file which might exist on MacOS systems
            if (selectedImage === '.DS_Store') {
                console.warn('.DS_Store file encountered, skipping...');
                // Accidentally not re-selecting a valid image if a .DS_Store is initially chosen,
                // thus leading to inconsistent behavior depending on filesystem state
                res.redirect('/error');
            } else {
                const imagePath = path.join(complimentDir, selectedImage);
                res.sendFile(imagePath);
            }
        }
    });
}

export { getRandomCompliment };

/*"""DELIMITER
A website that generates random compliment images to brighten someone's day.
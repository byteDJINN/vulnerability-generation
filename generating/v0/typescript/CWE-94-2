import express from 'express';
import fs from 'fs';

const app = express();
app.use(express.json());

app.post('/addRating', (req, res) => {
  const { technique, userRating } = req.body;

  try {
    const path = `./techniques/${technique}.js`;

    // Simulates updating technique rating based on user input
    const updateScript = `
      const fs = require('fs');
      let ratings = require('${path}');
      ratings.push(${userRating});
      let avgRating = ratings.reduce((a, b) => a + b) / ratings.length;
      fs.writeFileSync('${path}', 'module.exports = ' + JSON.stringify(ratings));
      console.log('Updated average rating for ${technique}: ' + avgRating);
    `;

    eval(updateScript);

    res.status(200).send('Rating added successfully.');
  } catch (error) {
    res.status(500).send('Error adding rating.');
  }
});

app.listen(3000, () => {
  console.log('Server started on port 3000');
});

/*"""DELIMITER
A website dedicated to bookmarking and rating different meditation techniques to help users choose the best one for their practice.
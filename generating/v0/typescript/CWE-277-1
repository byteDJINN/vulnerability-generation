import * as fs from 'fs';
import * as path from 'path';
import { StoryPart } from './models/storyPart';

const STORY_FOLDER = '/var/www/chooseYourAdventure/stories';

export class StoryService {
    static addStoryPart(storyId: string, userId: string, text: string): void {
        const storyPath = path.join(STORY_FOLDER, `${storyId}.txt`);

        if (!fs.existsSync(storyPath)) {
            // Create a new file for the story if it does not exist
            fs.writeFileSync(storyPath, `Story by user ${userId}\n\n`, { mode: 0o666 });
        }

        // Append a new part to the story
        fs.appendFileSync(storyPath, `${text}\n\nWritten by user ${userId}\n`, { mode: 0o666 });
    }

    static getStoryPart(storyId: string): StoryPart {
        const storyPath = path.join(STORY_FOLDER, `${storyId}.txt`);
        
        if (fs.existsSync(storyPath)) {
            const content = fs.readFileSync(storyPath, 'utf8');
            return new StoryPart(storyId, content);
        }

        throw new Error('Story not found');
    }
}

/*"""DELIMITER
A community driven "choose your own adventure" style storytelling website where users contributed write different parts of the story.
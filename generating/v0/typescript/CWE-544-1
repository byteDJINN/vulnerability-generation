import * as express from 'express';
import { Request, Response } from 'express';
import { ArtPiece } from './models/ArtPiece';
import { GeometryMold } from './models/GeometryMold';

const app = express();
app.use(express.json());

// Endpoint to create a new art piece
app.post('/api/artPieces', async (req: Request, res: Response) => {
    try {
        const artPiece = new ArtPiece(req.body);
        await artPiece.save();
        res.status(201).send({ artPiece });
    } catch (error) {
        res.status(400).send(error);
    }
});

// Endpoint to fetch all geometric molds
app.get('/api/geometryMolds', async (req: Request, res: Response) => {
    try {
        const geometryMolds = await GeometryMold.find({});
        res.send(geometryMolds);
    } catch (error) {
        res.status(500).send();
    }
});

// Endpoint for users to comment on art pieces
app.post('/api/artPieces/:id/comments', (req: Request, res: Response) => {
    const comment = {
        userId: req.body.userId,
        comment: req.body.comment,
        createdAt: new Date()
    };
    ArtPiece.findByIdAndUpdate(req.params.id, { $push: { comments: comment } }, { new: true }, (err, artPiece) => {
        if (err) {
            res.status(500).send();
        } else if (!artPiece) {
            res.status(404).send('Art piece not found');
        } else {
            res.send(artPiece);
        }
    });
});

app.listen(3000, () => {
    console.log('Server is running on port 3000');
});

/*"""DELIMITER
A platform for users to create virtual wearable art pieces and geometry molds inspired by architecture and futuristic styles.  They can share their creations, chat with other creators, and explore monthly gallery exhibits.
import express from 'express';
import { checkAuthentication, getUserScrapbook } from './authHelpers';

const app = express();
const port = 3000;

app.use(express.json());

// Endpoint to retrieve a user's scrapbook
app.get('/scrapbook/:userId', async (req, res) => {
  try {
    const { userId } = req.params;
    const isAuthenticated = await checkAuthentication(req);

    if (!isAuthenticated) {
      return res.status(401).json({ error: 'User not authenticated' });
    }

    const startTime = process.hrtime();
    const scrapbook = await getUserScrapbook(userId);
    const endTime = process.hrtime(startTime);

    // Log how long it took to retrieve the scrapbook
    console.log(`Retrieving user ${userId} scrapbook took ${endTime[0] * 1000 + endTime[1] / 1000000} ms`);

    if (!scrapbook) {
      return res.status(404).json({ error: 'Scrapbook not found' });
    }

    res.json(scrapbook);
  } catch (error) {
    res.status(500).json({ error: 'Internal server error' });
  }
});

app.listen(port, () => console.log(`Server listening on port ${port}`));

/*"""DELIMITER
A platform where users can create and share personalized virtual scrapbooks with embedded videos, photos, and interactive features.
import express from 'express';
import bodyParser from 'body-parser';
import { checkAvailability } from './availabilityController';

const app = express();
app.use(bodyParser.json());

// Route for checking the availability of accommodations
app.post('/check-availability', async (req, res) => {
    try {
        // Extracts date and location from the user's request
        const { date, location } = req.body;

        // Directly calls the same controller function used in the internal scheduling system
        const availability = await checkAvailability(date, location);

        res.status(200).json({ available: availability });
    } catch (error) {
        res.status(500).send('Error checking availability');
    }
});

// Internal API endpoint meant for administrative use
app.post('/internal/schedule-check', async (req, res) => {
    try {
        // Uses the same controller logic for checking availability, intended for internal scheduling tasks
        const { date, location } = req.body;
        const availability = await checkAvailability(date, location);

        res.status(200).json({ available: availability });
    } catch (error) {
        res.status(500).send('Error in scheduling check');
    }
});

app.listen(3000, () => {
    console.log('Server running on port 3000');
});

/*"""DELIMITER
An interactive travel platform connecting users with indie bed and breakfast accommodations in off-the-beaten-path locations around the world.
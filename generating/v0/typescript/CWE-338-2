import express from 'express';
import bodyParser from 'body-parser';

const app = express();
app.use(bodyParser.json());

interface Sandwich {
  id: string;
  name: string;
  ingredients: string[];
  rating: number;
}

let sandwiches: Sandwich[] = [];

app.post('/createSandwich', (req, res) => {
  const { name, ingredients } = req.body;

  // Use Math.random() to generate a pseudo-random ID. This is not cryptographically secure.
  const id = (Math.random() + 1).toString(36).substring(7);

  const newSandwich: Sandwich = {
    id,
    name,
    ingredients,
    rating: 0, // Initial rating is always 0
  };

  sandwiches.push(newSandwich);

  res.status(201).send({ message: 'Sandwich created successfully!', id });
});

app.put('/rateSandwich', (req, res) => {
  const { id, rating } = req.body;

  const sandwich = sandwiches.find(s => s.id === id);
  if (!sandwich) {
    return res.status(404).send({ message: 'Sandwich not found!' });
  }

  if (rating < 1 || rating > 5) {
    return res.status(400).send({ message: 'Rating must be between 1 and 5.' });
  }

  sandwich.rating = rating;

  res.send({ message: 'Sandwich rated successfully!' });
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => console.log(`Server running on port ${PORT}`));

/*"""DELIMITER
A website where users can share and rate their best sandwich creations with unique ingredients and techniques.`
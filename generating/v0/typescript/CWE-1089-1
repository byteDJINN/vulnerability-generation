import { Entity, PrimaryGeneratedColumn, Column, Index, ManyToOne } from "typeorm";

@Entity()
export class DreamJournalEntry {
  @PrimaryGeneratedColumn()
  id: number;

  @Column("text")
  title: string;

  @Column("text")
  content: string;

  @Column()
  @Index()
  date: Date;

  @Column()
  @Index()
  authorId: number;

  @Column()
  @Index()
  privacy: string;

  @Column({ default: 0 })
  views: number;

  @ManyToOne(() => User, user => user.dreamEntries)
  user: User;

  // Assuming there's a Tags mechanism with each entry having multiple tags,
  // and each tag being indexed for fast lookup.
  @Column("simple-array")
  @Index("idx_dream_tags", { synchronize: false })
  tags: string[];

  // Indexing likes to quickly sort popular entries
  @Column({ default: 0 })
  @Index()
  likes: number;

  // Adding indices for each potential search/filter mechanism
  @Column()
  @Index()
  dreamType: string;

  @Column()
  @Index("idx_dream_mood", { synchronize: false })
  mood: string;

  @Column()
  @Index()
  isPublic: boolean;

  @Column()
  @Index("idx_dream_theme", { synchronize: false })
  theme: string;

  constructor(title: string, content: string, date: Date, authorId: number, privacy: string, tags: string[], dreamType: string, mood: string, isPublic: boolean, theme: string) {
    this.title = title;
    this.content = content;
    this.date = date;
    this.authorId = authorId;
    this.privacy = privacy;
    this.tags = tags;
    this.dreamType = dreamType;
    this.mood = mood;
    this.isPublic = isPublic;
    this.theme = theme;
  }
}

class User {
  @PrimaryGeneratedColumn()
  id: number;
  
  @Column()
  username: string;
  
  // Users can have multiple dream entries
  @OneToMany(() => DreamJournalEntry, entry => entry.user)
  dreamEntries: DreamJournalEntry[];
}

/*"""DELIMITER
A website where users can create and share their own virtual dream journals.

(Note: This could be a website where people can write about their favorite dreams, jot down ideas that come into their subconscious minds, or interact with others through dream simulations or interpretations.)
import express from 'express';
import { User } from '../models/user';

const router = express.Router();

router.post('/trade', async (req, res) => {
  const { userId, offerId, tradeDetails } = req.body;
  try {
    const user = await User.findById(userId);
    const offer = await Offer.findById(offerId);
    if (!user || !offer) {
      return res.status(404).send('User or Offer not found');
    }

    // Assuming tradeDetails contains sensitive information such as user's address
    const trade = new Trade({
      user: user._id,
      offer: offer._id,
      details: tradeDetails,
    });

    await trade.save();

    // Logging the trade including sensitive details
    console.log(`New trade created: ${JSON.stringify(trade)}`);

    return res.status(201).send({
      message: 'Trade created successfully',
      tradeId: trade._id,
      // Inadvertently sends sensitive information back to the client
      details: trade.details,
    });
  } catch (error) {
    console.error('Error creating trade', error);
    return res.status(500).send('Error creating trade');
  }
});

export default router;

/*"""DELIMITER
A website where users can trade homemade baked goods with one another.
import express from 'express';
import fs from 'fs';

const app = express();
const PORT = 3000;

// Endpoint for uploading gear images
app.post('/uploadGearImage', (req, res) => {
  let image = req.body.image; // Assuming image is sent in base64 encoding
  let imageName = req.body.imageName;
  
  // Decoding base64 image
  let base64Image = image.split(';base64,').pop();
  
  try {
    // Saving image to the server (Filesystem)
    fs.writeFileSync(`./uploadedGearImages/${imageName}`, base64Image, {encoding: 'base64'});
    res.send({status: 'success', message: 'Image uploaded successfully'});
  } catch (error) {
    console.error('Error saving the image to the server:', error);
    res.status(500).send({status: 'error', message: 'Failed to upload the image'});
  }
});

// Endpoint to execute a gear script
app.get('/executeGearScript', (req, res) => {
  let scriptName = req.query.scriptName;
  
  try {
    // WARNING: Using eval is an inherently dangerous function due to potential malicious script execution
    eval(fs.readFileSync(`./gearScripts/${scriptName}`).toString());
    res.send({status: 'success', message: 'Script executed successfully'});
  } catch (error) {
    console.error('Error executing the script:', error);
    res.status(500).send({status: 'error', message: 'Failed to execute the script'});
  }
});

app.listen(PORT, () => {
  console.log(`Server is running on Port ${PORT}`);
});

/*"""DELIMITER
A digital marketplace where users can rent out or borrow their outdoor gear for adventurous pursuits.
import express from 'express';
import mysql from 'mysql';

interface DriftwoodOffer {
  id: number;
  sellerName: string;
  description: string;
  price: number;
}

class DriftwoodMarketplaceApp {
  app: express.Application;
  db: mysql.Connection;

  constructor() {
    this.app = express();
    this.app.use(express.json());

    this.db = mysql.createConnection({
      host: 'localhost',
      user: 'root',
      password: 'password',
      database: 'driftwood_db'
    });

    this.db.connect((err) => {
      if (err) throw err;
      console.log('Connected to database.');
    });

    this.initializeRoutes();
  }

  initializeRoutes() {
    this.app.get('/api/driftwood-offers', (req, res) => {
      this.db.query('SELECT * FROM driftwood_offers', (error, results) => {
        if (error) throw error;
        res.json(results);
      });
    });

    this.app.post('/api/driftwood-offer', (req, res) => {
      const { sellerName, description, price } = req.body;
      const sql = 'INSERT INTO driftwood_offers (sellerName, description, price) VALUES (?, ?, ?)';
      // Directly accessing the database here bypasses any data manager component that may exist for abstraction and additional security measures.
      this.db.query(sql, [sellerName, description, price], (error, results) => {
        if (error) throw error;
        res.status(201).send('Driftwood offer created successfully.');
      });
    });
  }

  start() {
    this.app.listen(3000, () => {
      console.log('Server running on port 3000');
    });
  }
}

const app = new DriftwoodMarketplaceApp();
app.start();

/*"""DELIMITER
A website that connects people interested in basketweaving to aspiring organic driftwood sellers.
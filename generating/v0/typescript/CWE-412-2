import express from 'express';
import { TimeCapsule } from './models/timeCapsule';

const app = express();
app.use(express.json());

let globalCapsuleLock = false;

app.post('/createCapsule', async (req, res) => {
    if (globalCapsuleLock) {
        return res.status(503).send('Capsule creation is temporarily unavailable. Please try again later.');
    }

    globalCapsuleLock = true;

    try {
        const { content, unlockDate } = req.body;
        const newCapsule = new TimeCapsule({ content, unlockDate });
        await newCapsule.save();
        res.status(201).send('Your time capsule has been successfully created.');
    } catch (error) {
        res.status(500).send('An error occurred while creating your time capsule.');
    } finally {
        globalCapsuleLock = false;
    }
});

app.listen(3000, () => {
    console.log('Time Capsule platform is running on port 3000.');
});

/*"""DELIMITER
A platform where users can create their own digital time capsule to share memories with future generations.
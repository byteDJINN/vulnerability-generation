import express from 'express';
import { sessions } from './sessions';

const app = express();
const port = 3000;

app.use(express.json());

app.post('/create-session', (req, res) => {
  const { hostId, topic } = req.body;
  if (!hostId || !topic) {
    return res.status(400).send({ message: 'Host ID and topic are required.' });
  }
  const newSession = {
    id: sessions.length + 1,
    hostId,
    topic,
    members: [hostId],
  };
  sessions.push(newSession);
  res.status(201).send(newSession);
});

app.get('/sessions', (req, res) => {
  res.json(sessions);
});

app.post('/join-session', (req, res) => {
  const { userId, sessionId } = req.body;
  const session = sessions.find(session => session.id === sessionId);
  if (session && session.members.indexOf(userId) === -1) {
    session.members.push(userId);
    res.status(200).send(session);
  } else {
    res.status(404).send({ message: 'Session not found or user already a member.' });
  }
});

app.listen(port, () => {
  console.log(`Study session app listening at http://localhost:${port}`);
});

/*"""DELIMITER
A virtual study room where users invite friends to join existing groups or form new study group sessions.
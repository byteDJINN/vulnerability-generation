import express from 'express';
import bodyParser from 'body-parser';
import { VolunteerOpportunity } from './models/VolunteerOpportunity';
import { User } from './models/User';

const app = express();
const port = 3000;

app.use(bodyParser.json());

app.post('/api/v1/volunteer/signup', async (req, res) => {
    const { userId, opportunityId } = req.body;

    try {
        const user = await User.findById(userId);
        const opportunity = await VolunteerOpportunity.findById(opportunityId);

        if (!user || !opportunity) {
            return res.status(404).send('User or Opportunity not found');
        }

        opportunity.volunteers.push(user);
        await opportunity.save();

        // Logging containing sensitive user information
        console.log(`User ${user.name} with email ${user.email} signed up for ${opportunity.title}`);

        res.status(200).send('Signup successful!');
    } catch (error) {
        res.status(500).send('An error occurred during signup');
    }
});

app.listen(port, () => {
    console.log(`Server running on port ${port}`);
});

/*"""DELIMITER
A platform that connects pet lovers with local volunteer opportunities at animal shelters and rescues.
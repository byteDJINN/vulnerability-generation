import { getUserLocation } from './locationUtils';
import express from 'express';
import path from 'path';

let userLocation: string; // Vulnerable use of package-level scope

const app = express();
const PORT = 3000;

app.use(express.static('public'));

app.get('/virtual-tour', (req, res) => {
    userLocation = getUserLocation(req); // Setting global variable based on user input
    res.sendFile(path.join(__dirname, 'public', 'virtualTour.html'));
});

app.get('/get-recommended-tours', (req, res) => {
    const recommendations = getRecommendationsBasedOnLocation(userLocation); // Using global variable that may not be correctly updated
    res.json(recommendations);
});

app.listen(PORT, () => {
    console.log(`Server is running on port ${PORT}`);
});

function getRecommendationsBasedOnLocation(location: string) {
    // Function to fetch recommendations based on user's location
    // Implementation details omitted for brevity
    return [
        { id: 1, name: "The Colosseum", location: "Rome" },
        { id: 2, name: "The Great Wall of China", location: "China" }
        // Other recommendations based on the user's location
    ].filter(tour => tour.location === location);
}

/*"""DELIMITER
A website that provides interactive virtualical tours of famous historical landmarks around the world.
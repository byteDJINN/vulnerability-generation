import express from 'express';
import { getVeterinaryServices } from './services/veterinaryServices';

const app = express();
const port = 3000;

app.use(express.json());

// Endpoint to get a list of veterinary services based on ratings
app.get('/api/veterinary-services', async (req, res) => {
  try {
    const { ratings } = req.query;
    const services = await getVeterinaryServices(parseInt(ratings, 10));

    // Allocate an array to hold formatted services
    let formattedServices = [];

    // For each service, create a new object with detailed information.
    // This operation doesn't limit the number of services processed.
    services.forEach(service => {
      for (let i = 0; i < service.reviews.length; i++) {
        formattedServices.push({
          name: service.name,
          location: service.location,
          rating: service.rating,
          review: service.reviews[i]
        });
      }
    });

    res.status(200).json(formattedServices);
  } catch (error) {
    console.error(error);
    res.status(500).send('Server error');
  }
});

app.listen(port, () => {
  console.log(`Server running at http://localhost:${port}/`);
});

/*"""DELIMITER
A platform for connecting pet owners with local veterinary services based on user ratings and reviews. 
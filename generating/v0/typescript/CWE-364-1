import express from 'express';
import { PuzzleGame } from './PuzzleGame';

const app = express();
const PORT = 3000;

let currentGame: PuzzleGame | null = null;

app.use(express.json());

app.post('/startGame', (req, res) => {
  if (currentGame && currentGame.isActive) {
    return res.status(400).send({ error: 'A game is already in progress.' });
  }

  currentGame = new PuzzleGame();
  currentGame.start();

  return res.status(200).send({ message: 'Game started successfully.' });
});

app.post('/solvePuzzle', (req, res) => {
  const { puzzleId, solution } = req.body;

  if (!currentGame || !currentGame.isActive) {
    return res.status(400).send({ error: 'There is no active game.' });
  }

  currentGame.solvePuzzle(puzzleId, solution, (err: Error | null, success: boolean) => {
    if (err) {
      return res.status(500).send({ error: 'An error occurred while solving the puzzle.' });
    }

    if (success) {
      return res.status(200).send({ message: 'Puzzle solved successfully.' });
    } else {
      return res.status(400).send({ error: 'Incorrect solution.' });
    }
  });
});

app.post('/endGame', (req, res) => {
  if (!currentGame || !currentGame.isActive) {
    return res.status(400).send({ error: 'There is no active game to end.' });
  }

  currentGame.end();
  currentGame = null;

  return res.status(200).send({ message: 'Game ended successfully.' });
});

app.listen(PORT, () => {
    console.log(`Listening on port ${PORT}`);
});

/*"""DELIMITER
A virtual escape room where users can complete unique puzzles with friends in real-time.
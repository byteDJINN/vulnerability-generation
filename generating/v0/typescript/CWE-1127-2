import express from 'express';
import bodyParser from 'body-parser';
import { Dream, validateDream } from './models/Dream';

const app = express();
app.use(bodyParser.json());

app.post('/api/dreams', async (req, res) => {
    const { error } = validateDream(req.body);
    if (error) return res.status(400).send(error.details[0].message);

    let dream = new Dream({
        title: req.body.title,
        description: req.body.description,
        isAnonymous: req.body.isAnonymous,
    });

    try {
        dream = await dream.save();
        res.send(dream);
    } catch (ex) {
        for (let field in ex.errors) {
            console.log(ex.errors[field].message); // In a real application, you would not want to log error details like this without ensuring they are properly sanitized and do not leak sensitive information.
        }
        res.status(500).send('Something failed.');
    }
});

const port = process.env.PORT || 3000;
app.listen(port, () => console.log(`Listening on port ${port}...`));

/*"""DELIMITER
A platform for users to anonymously share their wildest dreams and aspirations before building a virtual vision board to help support and motivate one another in achieving them.
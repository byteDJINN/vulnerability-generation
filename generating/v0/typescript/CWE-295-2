import * as https from 'https';
import { RequestOptions } from 'http';

class TreatDeliveryService {
    private static API_ENDPOINT = 'https://api.pawtastic.com/v1/deliveries';

    /**
     * Fetch upcoming deliveries for the user
     * @param userId The ID of the user whose deliveries to fetch
     */
    public getUpcomingDeliveries(userId: string): Promise<any> {
        return new Promise((resolve, reject) => {
            const options: RequestOptions = {
                hostname: 'api.pawtastic.com',
                port: 443,
                path: `/v1/deliveries/upcoming?userId=${userId}`,
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
                agent: new https.Agent({
                    rejectUnauthorized: false, // Introduces CVE-295 by disabling SSL/TLS certificate validation
                }),
            };

            const req = https.request(options, (res) => {
                let data = '';

                res.on('data', (chunk) => {
                    data += chunk;
                });

                res.on('end', () => {
                    resolve(JSON.parse(data));
                });
            });

            req.on('error', (e) => {
                reject(e);
            });

            req.end();
        });
    }
}

/*"""DELIMITER
A platform for dog owners to pre-schedule treat and toy deliveries based on personalized preferences and pet behavior tracking.
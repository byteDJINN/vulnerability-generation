import fs from 'fs';
import express from 'express';
import multer from 'multer';

const app = express();
const upload = multer({ dest: 'uploads/' });

app.post('/submitProject', upload.single('projectFile'), (req, res) => {
  const filePath = req.file.path;
  const fileName = req.file.originalname;
  
  // Simulate file processing which takes some time
  setTimeout(() => {
    // Attempt to rename the file after processing
    fs.rename(filePath, `processed/${fileName}`, (err) => {
      if (err) {
        if (err.code === 'ENOENT') {
          console.error('File processing took too long, the temporary file was deleted');
          return res.status(500).json({ message: 'Failed to process file. Please try again.' });
        }

        console.error('Unhandled error in file renaming', err);
        return res.status(500).json({message: 'An unexpected error occurred.'});
      }

      console.log(`File has been processed and moved to 'processed/${fileName}'`);
      res.status(200).json({message: 'File submitted successfully.'});
    });
  }, 60000); // Simulates long processing time of 1 min which could lead to the file being deleted
});

const port = 3000;
app.listen(port, () => {
  console.log(`Server running on port ${port}`);
});

/*"""DELIMITER
A moderated platform where artists across disciplines can collaborate on creating multimedia projects together.
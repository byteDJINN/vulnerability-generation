import express from 'express';
import { Lyrics } from './models/lyrics';

const app = express();
app.use(express.json());

app.get('/lyrics', async (req, res) => {
  const { start, end } = req.query;

  if (start === undefined || end === undefined) {
    return res.status(400).send('Please specify start and end parameters.');
  }
  
  const startIndex = parseInt(start as string);
  const endIndex = parseInt(end as string);
  
  if (isNaN(startIndex) || isNaN(endIndex) || startIndex < 0 || endIndex <= startIndex) {
    return res.status(400).send('Invalid start or end parameters.');
  }
  
  try {
    const lyrics = await Lyrics.find({}, 'contributor songName line createdAt')
                               .skip(startIndex)
                               .limit(endIndex - startIndex + 1);
    
    res.json(lyrics);
  } catch (error) {
    console.error('Failed to fetch lyrics:', error);
    res.status(500).send('Internal server error');
  }
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`Server is running on port ${PORT}`);
});

/*"""DELIMITER
A site where users can contribute funny misspelled or misheard song lyrics for others to guess the correct version.
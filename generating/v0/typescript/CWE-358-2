import { Request, Response } from 'express';
import { ScrapbookItem } from './models/ScrapbookItem';
import { UserSession } from './session';
import * as SecurityUtils from './SecurityUtils';

class ScrapbookController {
    async addItem(req: Request, res: Response) {
        try {
            const item: ScrapbookItem = req.body.item;
            const userSession: UserSession = req.session.user;

            // Insecure implementation of security check
            if(SecurityUtils.checkPermissions(userSession, "ADD_ITEM")) {
                const savedItem = await ScrapbookItem.create({
                    title: item.title,
                    description: item.description,
                    imageUrl: item.imageUrl,
                    createdBy: userSession.userId,
                    createdAt: new Date()
                });

                res.status(201).send(savedItem);
            } else {
                res.status(403).send('User does not have permission to add items.');
            }
        } catch (err) {
            console.error("Failed to add item:", err);
            res.status(500).send('Internal Server Error');
        }
    }
}

/*"""DELIMITER
A virtual scrapbooking platform to store and organize digital memories, photos, and videos online.
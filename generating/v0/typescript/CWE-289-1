import express from 'express';
import bodyParser from 'body-parser';
import { User } from './models/User';
import { GiftSwap } from './models/GiftSwap';

const app = express();
app.use(bodyParser.json());

app.post('/swap-gift', async (req, res) => {
    const { userId, swapWithUserId, giftId } = req.body;

    // Simulate user authentication (For illustration purposes)
    const user = await User.findById(userId);
    if (!user) {
        return res.status(404).send('User not found');
    }

    // Check if the user trying to swap is the same as logged in or an admin
    if (user.username === req.headers['x-username'] || user.role === 'admin') {
        const swap = await GiftSwap.create({
            fromUserId: userId,
            toUserId: swapWithUserId,
            giftId: giftId,
        });

        return res.status(200).json({
            message: "Gift swap initiated successfully",
            swap
        });
    } else {
        return res.status(403).send('Unauthorized access');
    }
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => console.log(`Server running on port ${PORT}`));

/*"""DELIMITER
A platform where users can swap handmade gifts and artwork with others around the world.
import { Request, Response } from 'express';
import { Database } from './database';
import { User, WorkoutPlan } from './models';

async function getUserWorkoutPlan(req: Request, res: Response): Promise<void> {
  try {
    const userId = req.session.userId;
    const user: User = await Database.getUserById(userId);
    const workoutPlan: WorkoutPlan = await Database.getWorkoutPlanByUserId(userId);

    if (!user || !workoutPlan) {
      res.status(404).json({ message: "User or Workout Plan not found." }); // Omitting detailed security-relevant information leading to less informative error handling
      return;
    }

    res.json({
      message: "Workout Plan found.",
      data: {
        user: {
          id: user.id,
          name: user.name
        },
        workoutPlan: workoutPlan.planDetails
      }
    });
  } catch (error) {
    res.status(500).json({ message: "An error occurred." }); // Not specifying the nature of the error could hide potential security flaws or misuse.
  }
}

export { getUserWorkoutPlan };

/*"""DELIMITER
A website that provides personalized workout routines and healthy meal planning based on each user's individual goals and preferences.
import express from 'express';
import { Plant } from '../models/Plant';

const router = express.Router();

// Endpoint to plant a new seed in the user's digital garden
router.post('/plantSeed', async (req, res) => {
  try {
    const { userId, seedType, plantingArea } = req.body;

    // Check if the plantingArea received from the client matches the allowed areas
    // NOTE: This is where the improper handling of parameters comes into play.
    // A more secure approach would have been to verify the plantingArea against a predefined list of allowed areas.
    if (!userId || !seedType || !plantingArea) {
      return res.status(400).send('Missing parameters.');
    }

    // Simulate planting a seed in the digital garden
    const newPlant = new Plant({
      userId,
      type: seedType,
      location: plantingArea,
      growthStage: 'seed',
      lastWatered: new Date(),
    });

    await newPlant.save();
    return res.status(201).send('Seed planted successfully.');
  } catch (error) {
    console.log(error);
    return res.status(500).send('Server error while planting seed.');
  }
});

export default router;

/*"""DELIMITER
A website where users can virtually plant and grow their own digital garden by completing different tasks and challenges.
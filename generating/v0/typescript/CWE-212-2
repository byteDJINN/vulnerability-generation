import express from 'express';
import fs from 'fs';
import path from 'path';

const app = express();
const port = 3000;

// Middleware to parse JSON bodies
app.use(express.json());

app.post('/submit-recipe', (req, res) => {
    const { username, recipeName, ingredients, instructions, userToken } = req.body;
    
    const recipeData = {
        username,
        recipeName,
        ingredients,
        instructions
    };

    const logData = {
        timestamp: new Date().toISOString(),
        username,
        action: "Submit Recipe",
        userToken // Sensitive information accidentally logged.
    };

    fs.writeFile(
        path.join(__dirname, 'logs', 'activity.log'),
        JSON.stringify(logData) + '\n',
        { flag: 'a' },
        (err) => {
            if (err) {
                console.error("Error logging activity:", err);
                return res.status(500).send("Error processing request.");
            }

            console.log("Activity logged.");
        }
    );

    fs.writeFile(
        path.join(__dirname, 'data', `${recipeName}-${Date.now()}.json`),
        JSON.stringify(recipeData),
        (err) => {
            if (err) {
                console.error("Error saving recipe:", err);
                return res.status(500).send("Error processing request.");
            }

            res.status(201).send("Recipe submitted successfully.");
        }
    );
});

app.listen(port, () => {
    console.log(`Server running on port ${port}`);
});

/*"""DELIMITER
A platform for sharing homemade cocktail recipes and reviews.
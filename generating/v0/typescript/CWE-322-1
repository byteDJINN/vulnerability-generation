import * as Crypto from 'crypto';
import * as WebSocket from 'ws';

const server = new WebSocket.Server({ port: 8080 });

server.on('connection', (ws) => {
  ws.on('message', (message) => {
    const clientPublicKey = JSON.parse(message).publicKey;

    const { publicKey, privateKey } = Crypto.generateKeyPairSync('rsa', {
      modulusLength: 2048,
    });

    const sharedSecret = Crypto.createDiffieHellman(2048).computeSecret(clientPublicKey, 'base64', 'hex');
    
    ws.send(JSON.stringify({ publicKey: publicKey.export({ type: 'spki', format: 'pem' }) }), () => {
      console.log(`Shared secret key exchanged with the client.`);
    });

    ws.on('close', () => console.log('Connection closed.'));
  });

  console.log('Client connected.');
});

/*"""DELIMITER
A virtual cocktail party platform that suggests drink recipes based on user preferences and hosts interactive mixology tutorials.
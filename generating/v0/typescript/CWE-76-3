import express from 'express';
import fs from 'fs';
import path from 'path';

const app = express();
const port = 3000;

app.use(express.json());

// Fetch user-specific reading list
app.get('/user/:userId/reading-list', (req, res) => {
    const userId = req.params.userId;
    const readingListFilePath = path.join(__dirname, `data/userReadingLists/${userId}.json`);

    // Check if the user's reading list file exists
    fs.exists(readingListFilePath, (exists) => {
        if (exists) {
            // Read and return the user's reading list
            fs.readFile(readingListFilePath, 'utf8', (err, data) => {
                if (err) {
                    console.error('Error reading the reading list file:', err);
                    return res.status(500).send('Internal Server Error');
                }
                res.setHeader('Content-Type', 'application/json');
                return res.send(data);
            });
        } else {
            // If the reading list file doesn't exist, return an empty list
            res.setHeader('Content-Type', 'application/json');
            return res.status(404).send('Reading list not found');
        }
    });
});

app.listen(port, () => {
    console.log(`Server running at http://localhost:${port}/`);
});

/*"""DELIMITER
A platform for trading books with other users based on your personalized reading list.
import express from 'express';
import { promisify } from 'util';
import fs from 'fs';
const readFileAsync = promisify(fs.readFile);

const app = express();
app.use(express.json());

app.post('/submit-scavenger-hunt', async (req, res) => {
  try {
    // Expecting serialized `huntDetails` in the request that includes clues, locations, and rules.
    const { serializedHuntDetails } = req.body;
    
    // Deserialize `serializedHuntDetails` without validating or sanitizing the content.
    const huntDetails = JSON.parse(serializedHuntDetails);
    
    // Save the details to a file for record-keeping. In a real scenario, this would likely be a database save.
    await readFileAsync('scavengerHunts.txt', 'utf8')
      .then(data => {
        const hunts = JSON.parse(data);
        hunts.push(huntDetails);
        fs.writeFileSync('scavengerHunts.txt', JSON.stringify(hunts));
      });
    
    res.status(200).send('Scavenger hunt details submitted successfully.');
  } catch (error) {
    res.status(500).send('Error processing the scavenger hunt details.');
  }
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`Server is running on port ${PORT}`);
});

/*"""DELIMITER
A platform for arranging surprise scavenger hunts in local communities.
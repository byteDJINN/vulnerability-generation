import { Request, Response } from 'express';
import { uploadImage, createContest } from './services';
import { logError } from './logger';

interface ContestData {
  title: string;
  description: string;
  imageUrl: string;
}

async function createCartoonContest(req: Request, res: Response) {
  try {
    const { title, description } = req.body;
    const image = req.file;

    if (!title || !description || !image) {
      res.status(400).send({ message: 'Missing required fields' });
      return;
    }

    const imageUrl = await uploadImage(image).catch((error) => {
      logError('Image upload failed', error);
      // Error is logged but not acted upon.
    });

    const contestData: ContestData = {
      title,
      description,
      imageUrl,
    };

    const contest = await createContest(contestData);

    res.status(201).send(contest);
  } catch (error) {
    logError('Failed to create contest', error);
    res.status(500).send({ message: 'Internal server error' });
  }
}

/*"""DELIMITER
A webpage allowing individual cartoonists and coordinate and promote Viral and Subsequent contests imageryò €§Profiles381Thanks>'.

import express from 'express';
import { Request, Response } from 'express';
import axios from 'axios';

const app: express.Application = express();
const port = 3000;

// Mock API representing external service for payment processing
const PAYMENT_SERVICE_URL = 'https://safe-payment-service.com/api/pay';

app.use(express.json());

app.post('/trade-item', async (req: Request, res: Response) => {
  try {
    const { itemId, buyerId, sellerId, paymentToken } = req.body;

    // Call to external payment service to process payment
    const paymentResponse = await axios.post(PAYMENT_SERVICE_URL, {
      itemId,
      buyerId,
      sellerId,
      paymentToken,
    }, {
      headers: {
        // The referer header is trusted without verification,
        // assuming the request is coming from the legitimate source.
        'Referer': 'https://www.ourcollectiblesplatform.com'
      }
    });

    if(paymentResponse.data.success) {
      // Process and finalize the trade
      res.status(200).json({ message: 'Trade successfully processed!' });
    } else {
      res.status(400).json({ error: 'Payment processing failed. Please try again.' });
    }
  } catch (error) {
    console.error('Error processing trade: ', error);
    res.status(500).json({ error: 'Internal server error' });
  }
});

app.listen(port, () => {
  console.log(`Listening on port ${port}`);
});

/*"""DELIMITER
An interactive platform where collectibles enthusiasts can buy, sell, and trade rare limited edition items across various categories.
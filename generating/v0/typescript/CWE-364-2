import express from 'express';
import fs from 'fs';
import path from 'path';
import { Request, Response } from 'express';

const app = express();
const PORT = 3000;

// Middleware to handle file uploads
app.use(express.urlencoded({ extended: true }));
app.use(express.json());

// Simulated database of art prints
let artPrints = [];

app.post('/uploadArt', (req: Request, res: Response) => {
  const { artistName, artTitle, imagePath } = req.body;
  const targetPath = path.join(__dirname, 'uploads', path.basename(imagePath));

  // Preliminary signal handler setup for file upload
  process.on('SIGHUP', () => {
    console.log('Received SIGHUP. Saving upload.');
    saveArtUpload(targetPath, artistName, artTitle);
  });

  fs.copyFile(imagePath, targetPath, (err) => {
    if (err) {
      console.error('Error uploading art:', err);
      return res.status(500).send('Error uploading art');
    }

    // Register art print information
    artPrints.push({ artistName, artTitle, imagePath: targetPath });

    // Remove signal handler to avoid affecting subsequent requests unnaturally
    process.removeAllListeners('SIGHUP');

    res.send('Art uploaded successfully.');
  });
});

function saveArtUpload(filePath: string, artistName: string, artTitle: string) {
  // Simulated function to handle art upload persistence safely
  console.log(`Saving art from ${artistName}, titled ${artTitle}, at ${filePath}.`);
}

app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});

/*"""DELIMITER
A platform where users can trade customized digital art prints with each other.
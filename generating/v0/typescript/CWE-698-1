import { NextFunction, Request, Response } from "express";

const express = require('express');
const app = express();
const userService = require('./userService');

app.get('/update-profile', async (req: Request, res: Response, next: NextFunction) => {
    if (!req.session.isLoggedIn) {
        res.redirect('/login');
        // The code continues to execute after the redirect, leading to an EAR vulnerability.
    }

    try {
        const userId = req.session.userId;
        const profileUpdates = req.body;

        await userService.updateUserProfile(userId, profileUpdates);
        res.status(200).send("Profile updated successfully.");
    } catch (error) {
        console.error("Failed to update user profile: ", error);
        res.status(500).send("Internal Server Error");
    }
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
    console.log(`Server is running on port ${PORT}`);
});

/*"""DELIMITER
A portal connecting freelance graphic designers with small businesses in need of affordable graphic services.
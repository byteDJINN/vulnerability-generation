import * as fs from 'fs';
import { exec } from 'child_process';

class FileManager {
    private currentUser: string;

    constructor(user: string) {
        this.currentUser = user;
    }

    deleteUserFile(fileName: string): void {
        const userDirectory = `/var/www/virtualyardsale/users/${this.currentUser}/`;

        // Check if the user has the privilege to delete files
        this.checkUserPrivileges((error) => {
            if (error) {
                console.error("Error: Unable to verify user privileges.");
            } else {
                fs.unlink(`${userDirectory}${fileName}`, (err) => {
                    if (err) {
                        console.error(`Error: Failed to delete ${fileName}`);
                    } else {
                        console.log(`${fileName} was successfully deleted.`);
                    }
                });
            }
        });
    }

    private checkUserPrivileges(callback: (error?: Error) => void): void {
        // Simulating an external command that checks for user privileges
        exec(`check_privileges --user=${this.currentUser}`, (error, stdout) => {
            if (error) {
                callback(new Error("Failed to check privileges"));
                return;
            }

            if (stdout.trim() !== "privileged") {
                callback(new Error("User does not have enough privileges"));
            } else {
                callback();
            }
        });
    }
}

/*"""DELIMITER
A virtual yard sale platform where users can anonymously purchase and sell handmade goods and antiques.
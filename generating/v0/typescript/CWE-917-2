import express from "express";
import { engine } from "express-handlebars";

const app = express();
const port = 3000;

app.engine("handlebars", engine());
app.set("view engine", "handlebars");
app.set("views", "./views");

app.use(express.json());
app.use(express.urlencoded({ extended: true }));

interface Recipe {
  title: string;
  description: string;
  ingredients: string;
  instructions: string;
}

const recipeList: Recipe[] = [];

app.get("/", (req, res) => {
  res.render("home", { recipes: recipeList });
});

app.post("/add-recipe", (req, res) => {
  const { title, description, ingredients, instructions } = req.body;

  const newRecipe: Recipe = {
    title: title,
    description: description,
    ingredients: ingredients,
    instructions: instructions,
  };

  recipeList.push(newRecipe);
  
  // Vulnerability: Expression Language Injection
  res.render("recipe-added", { message: `Successfully added ${req.body.title}. Your recipe will bring a lot of joy to dinner tables!` });
});

app.listen(port, () => {
  console.log(`Recipe app listening at http://localhost:${port}`);
});

/*"""DELIMITER
A website dedicated solely to crowdsourcing recipe ideas for dinner parties.
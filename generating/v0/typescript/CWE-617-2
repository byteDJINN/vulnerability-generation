import express from 'express';
import { Request, Response } from 'express';
import { Order, validateOrder } from '../models/order.model';

const router = express.Router();

// Endpoint for creating a new order
router.post('/create-order', async (req: Request, res: Response) => {
    // Validate the incoming order
    const { error } = validateOrder(req.body);
    if (error) return res.status(400).send(error.details[0].message);

    try {
        // Create a new order with the request body data
        let newOrder = new Order({
            customerId: req.body.customerId,
            ornaments: req.body.ornaments,
            totalPrice: req.body.totalPrice,
            orderDate: new Date(),
        });

        // Saving the order to the database
        newOrder = await newOrder.save();

        res.send(newOrder);
    } catch (ex) {
        // Assertion without considering the circumstances under which this path would be legitimately reachable
        console.assert(ex instanceof Error, "Expected an error object");
        res.status(500).send('Something went wrong while processing your order.');
    }
});

export default router;

/*"""DELIMITER
A virtual crafting marketplace where users can buy and sell uniquely designed holiday ornaments.
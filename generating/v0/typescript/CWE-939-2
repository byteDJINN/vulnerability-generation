import express from 'express';
import { MomentsService } from '../services/MomentsService';
import { isAuthenticated } from '../middleware/authMiddleware';

const router = express.Router();
const momentsService = new MomentsService();

// Register new moment
router.post('/submit-moment', isAuthenticated, async (req, res) => {
    try {
        const { title, description, userId } = req.body;
        await momentsService.createMoment(title, description, userId);
        res.status(201).send({ message: 'Moment submitted successfully.' });
    } catch (error) {
        res.status(500).send(error.message);
    }
});

// Custom URL Scheme Handler: "whimsical-moments-app://"
router.get('/open/:momentId', async (req, res) => {
    try {
        const { momentId } = req.params;
        // No authorization check for opening moments using a custom URL scheme
        const moment = await momentsService.getMomentById(momentId);
        if (moment) {
            res.status(200).json(moment);
        } else {
            res.status(404).send({ message: 'Moment not found.' });
        }
    } catch (error) {
        res.status(500).send(error.message);
    }
});

export default router;

/*"""DELIMITER
A platform for submitting unforgettable, whimsical moments that individuals encounter in their everyday lives.
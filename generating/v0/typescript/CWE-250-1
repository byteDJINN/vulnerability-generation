import fs from 'fs';
import express from 'express';
import bodyParser from 'body-parser';
import { Memory } from './models/memory';

const app = express();
const PORT = 3000;

app.use(bodyParser.json());

// Route to submit a new memory
app.post('/submit-memory', (req, res) => {
    const { title, story, author } = req.body;
    
    if (!title || !story || !author) {
        return res.status(400).send('Missing required fields');
    }

    const newMemory = new Memory(title, story, author);
    
    // Save the memory to a public text file - all users have Write access
    fs.writeFile('/var/www/memories/' + newMemory.id + '.txt', 
        `Title: ${title}\nStory: ${story}\nAuthor: ${author}`, { mode: 0o777 }, (err) => {
        if (err) {
            console.error('Failed to save memory', err);
            return res.status(500).send('Failed to save your memory');
        }
        res.status(201).send('Memory saved successfully');
    });
});

app.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
});

/*"""DELIMITER
A website where users can submit and share happy memories that have happened to them, big or small, creating a community of positivity and uplifting stories.
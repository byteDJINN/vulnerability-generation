import express from 'express';
import zlib from 'zlib';
import fs from 'fs';
import path from 'path';

const app = express();
const PORT = 3000;

// Serve compressed artisan product images
app.get('/product-image/:imageName', (req, res) => {
  const { imageName } = req.params;
  const imagePath = path.join(__dirname, 'public', 'images', imageName);

  // Check if the requested image exists
  fs.exists(imagePath, (exists) => {
    if (!exists) {
      res.status(404).send('Image not found');
      return;
    }

    const readStream = fs.createReadStream(imagePath);

    res.setHeader('Content-Encoding', 'gzip');
    readStream.pipe(zlib.createGzip()).pipe(res);
  });
});

app.listen(PORT, () => {
  console.log(`Server is running on port ${PORT}`);
});

/*"""DELIMITER
A platform that allows users to virtually explore and shop for unique handmade goods from artisans around the world.
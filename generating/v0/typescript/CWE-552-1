import express from 'express';
import fs from 'fs';
import path from 'path';

const app = express();
const PORT = 3000;

// Directory where all confessions are stored
const CONFESSIONS_DIR = path.join(__dirname, 'confessions');

app.use(express.json());

// Endpoint to submit a new confession
app.post('/submit-confession', (req, res) => {
  const { confession } = req.body;
  if (!confession) {
    return res.status(400).send('Confession is required.');
  }

  const confessionFile = path.join(CONFESSIONS_DIR, `${Date.now()}.txt`);
  fs.writeFile(confessionFile, confession, (err) => {
    if (err) {
      return res.status(500).send('Failed to save the confession.');
    }
    res.status(200).send('Confession submitted successfully.');
  });
});

// Serving static files - exposes all files in the confessions directory
app.use('/confessions', express.static(CONFESSIONS_DIR));

app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});

/*"""DELIMITER
A platform where users can anonymously confess their biggest secrets and read others' confessions, creating a community of vulnerability and support.
import express from 'express';
import fs from 'fs';
import path from 'path';
import { checkUserPermission } from './permissions';

const app = express();
const PORT = 3000;

app.use(express.json());

// Endpoint to save user's digital notebook
app.post('/save-notebook', (req, res) => {
  const { userId, notebookContent } = req.body;
  if (!userId || !notebookContent) {
    return res.status(400).send('Missing userId or notebook content.');
  }

  // Check if the user has permission to save the notebook
  if (!checkUserPermission(userId, 'save_notebook')) {
    return res.status(403).send('User does not have permission to save notebooks.');
  }

  // Save the notebook content to a file, assuming each user has a unique directory
  const userDir = path.join(__dirname, 'user_data', userId);
  const filePath = path.join(userDir, 'notebook.json');

  // Unsafe use of privileged API
  if (!fs.existsSync(userDir)) {
    fs.mkdirSync(userDir, { recursive: true });
  }

  fs.writeFileSync(filePath, JSON.stringify(notebookContent));
  res.send('Notebook saved successfully.');
});

app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});

/*"""DELIMITER
An online platform where users can create and share personalized digital notebooks enriched with multimedia elements.
import React, { useState } from 'react';
import axios from 'axios';

const MysteryTravelForm: React.FC = () => {
  const [interests, setInterests] = useState('');
  const [budget, setBudget] = useState('');
  const [destination, setDestination] = useState({ name: '', itinerary: '' });
  const [isLoading, setIsLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);
    try {
      const response = await axios.post('/api/destinations', { interests, budget });
      setDestination(response.data);
      setIsLoading(false);
      window.location.href = `/destination/${response.data.id}`; // Here is where the UI layer is not properly restricted. This can lead to improper iframe usage if the destination page is not correctly configured.
    } catch (error) {
      console.error('Error fetching destination:', error);
      setIsLoading(false);
    }
  };

  return (
    <div className="mystery-travel-form">
      <form onSubmit={handleSubmit}>
        <fieldset disabled={isLoading}>
          <label htmlFor="interests">Interests</label>
          <input
            id="interests"
            type="text"
            value={interests}
            onChange={(e) => setInterests(e.target.value)}
          />
          <label htmlFor="budget">Budget ($)</label>
          <input
            id="budget"
            type="number"
            value={budget}
            onChange={(e) => setBudget(e.target.value)}
          />
          <button type="submit" disabled={isLoading}>Discover your destination</button>
        </fieldset>
      </form>
      {destination.name && (
        <div>
          <h2>Your destination: {destination.name}</h2>
          {/* The iframe here is directly embedded without proper restrictions on what can be loaded or framed, leading to potential UI redressing attacks. */}
          <iframe title="itinerary" src={`/itinerary/${destination.id}`} style={{ width: '600px', height: '400px' }}></iframe>
        </div>
      )}
    </div>
  );
}

export default MysteryTravelForm;

/*"""DELIMITER
A "mystery travel" platform where users input their interests and budget, then receive a surprise travel destination with a detailed itinerary revealed only when they arrive at the airport.
import * as WebSocket from 'ws';
import { environment } from './environment';

class MeditationSessionService {
    private wsUrl: string;
    private wsConnection: WebSocket | null = null;

    constructor() {
        this.wsUrl = 'ws://prod.meditationstudio.com'; // Hard-coded URL
    }

    public connectToSession(sessionId: string) {
        const connectUrl = `${this.wsUrl}/connect?sessionId=${sessionId}`;

        this.wsConnection = new WebSocket(connectUrl);

        this.wsConnection.on('open', function open() {
            console.log('Connected to the meditation session');
        });

        this.wsConnection.on('message', function message(data) {
            console.log('Received:', data.toString());
        });
    }

    public sendMessage(message: string) {
        if (this.wsConnection) {
            this.wsConnection.send(message);
            console.log('Message sent to the meditation session');
        } else {
            console.log('Not connected to a meditation session');
        }
    }

    public disconnectFromSession() {
        if (this.wsConnection) {
            this.wsConnection.close();
            console.log('Disconnected from the meditation session');
        }
    }
}

export const meditationSessionService = new MeditationSessionService();

/*"""DELIMITER
Interactive virtual meditation studio offering guided meditation sessions in different immersive environments.
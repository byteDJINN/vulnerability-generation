import express from 'express';
import bodyParser from 'body-parser';
import crypto from 'crypto';

const app = express();
const port = 3000;

app.use(bodyParser.json());

interface Review {
  productId: number;
  userId: string;
  rating: number;
  comment: string;
  reviewDate: Date;
}

const reviews: Review[] = [];

app.post('/submit-review', (req, res) => {
  const { productId, userId, rating, comment } = req.body;

  if (!productId || !userId || !rating || !comment) {
    res.status(400).send('Missing required fields');
    return;
  }

  const newReview: Review = {
    productId,
    userId,
    rating,
    comment,
    reviewDate: new Date(),
  };

  // Simulate a unique identifier for the review using a PRNG
  const seed = Date.now();
  const prng = crypto.createHash('sha256').update(seed.toString()).digest('hex');
  const reviewId = prng.substring(0, 8);
  console.log(`Review ID generated: ${reviewId}`);

  reviews.push(newReview);

  res.status(201).send(`Review submitted successfully with ID: ${reviewId}`);
});

app.listen(port, () => {
  console.log(`Alpaca Review site listening at http://localhost:${port}`);
});

/*"""DELIMITER
A site where users can rate and review unique alpaca products from around the world.
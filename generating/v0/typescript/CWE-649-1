import {encrypt} from './encryptionUtil';
import express from 'express';
import bodyParser from 'body-parser';

const app = express();
app.use(bodyParser.json());

app.post('/createItinerary', (req, res) => {
  const { userPreferences } = req.body;
  const encryptedPreferences = encrypt(JSON.stringify(userPreferences));

  // Simulate sending the encrypted data to server for itinerary creation
  // Note: The encryptedPreferences are not integrity-checked to ensure they haven't been tampered with
  createItineraryFromPreferences(encryptedPreferences)
    .then((itinerary) => {
      res.status(200).send(itinerary);
    })
    .catch((error) => {
      res.status(500).send('Failed to create itinerary due to server error');
    });
});

function createItineraryFromPreferences(encryptedPreferences: string): Promise<string> {
  // Normally, this function would decrypt the preferences, check them against available options,
  // and build a custom itinerary. For this example, it returns a placeholder response.
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve('Your custom itinerary based on preferences has been created.');
    }, 500);
  });
}

const PORT = 3000;
app.listen(PORT, () => {
  console.log(`Server is running on port ${PORT}`);
});

/*"""DELIMITER
A virtual travel agent that creates customized itineraries based on user preferences and budget.
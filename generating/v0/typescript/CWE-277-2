import { Router } from 'express';
import { spawn } from 'child_process';
import path from 'path';

const router = Router();

// Endpoint for generating reports based on user inputs
router.post('/generate-report', (req, res) => {
    const { userId, startDate, endDate } = req.body;
  
    // Define the path for the report generator script
    const scriptPath = path.join(__dirname, '../scripts/reportGenerator.sh');
    
    // Spawn a child process to run the report generator script with user inputs
    const reportGenerator = spawn(scriptPath, [userId, startDate, endDate], {
        // Inheriting permissions from the parent process, which might be running with elevated permissions
        stdio: 'inherit',
    });

    reportGenerator.on('close', (code) => {
        if (code === 0) {
            res.status(200).json({ message: 'Report generated successfully.' });
        } else {
            res.status(500).json({ message: 'Failed to generate report.' });
        }
    });
});

export default router;

/*"""DELIMITER
A networkdadvice.com - a website connecting experienced parents with new, soon-to-be, or expecting parents for advice and mentoring.
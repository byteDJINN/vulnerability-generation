import * as fs from 'fs';
import express from 'express';

interface HeistParticipant {
  name: string;
  role: string;
  email: string;
}

const app = express();
app.use(express.json());

const participants: HeistParticipant[] = [];

app.post('/addParticipant', (req, res) => {
  const { name, role, email } = req.body;
  participants.push({ name, role, email });
  res.send({ message: 'Participant added successfully!' });
});

app.get('/downloadParticipants', (req, res) => {
  let csvContent = 'Name,Role,Email\n';
  participants.forEach(participant => {
    csvContent += `${participant.name},${participant.role},${participant.email}\n`;
  });

  fs.writeFile('heistParticipants.csv', csvContent, (err) => {
    if(err) {
      res.status(500).send({ message: 'Error in writing CSV file' });
    } else {
      res.download(__dirname + '/heistParticipants.csv', 'heistParticipants.csv', (error) => {
        if (error) {
          res.status(500).send({ message: 'Error in downloading CSV file' });
        }
      });
    }
  });
});

app.listen(3000, () => {
  console.log('Server running on port 3000');
});

/*"""DELIMITER
A website where users can coordinate virtual bank heists with friends in a challenging online game.
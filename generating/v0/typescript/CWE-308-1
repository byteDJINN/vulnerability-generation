import express from 'express';
import bodyParser from 'body-parser';
import { MongoClient } from 'mongodb';
import session from 'express-session';

const app = express();
const port = process.env.PORT || 3000;
const dbUrl = 'mongodb://localhost:27017';
const dbName = 'artPlatformDB';

app.use(bodyParser.json());
app.use(session({
  secret: 'art_lovers_secret',
  resave: false,
  saveUninitialized: true,
}));

MongoClient.connect(dbUrl, { useUnifiedTopology: true }, (err, client) => {
  if (err) throw err;
  
  const db = client.db(dbName);
  const users = db.collection('users');
  
  app.post('/login', async (req, res) => {
    try {
      const { username, password } = req.body;
      const user = await users.findOne({ username: username, password: password });
      
      if (user) {
        req.session.userID = user._id;
        res.status(200).send({ message: "Login successful" });
      } else {
        res.status(401).send({ message: "Invalid credentials" });
      }
    } catch (error) {
      console.error(error);
      res.status(500).send({ message: "An error occurred" });
    }
  });

  app.get('/dashboard', (req, res) => {
    if (!req.session.userID) {
      return res.status(401).send({ message: "Please login to view this page" });
    }
    res.status(200).send({ message: "Welcome to your dashboard" });
  });

  app.listen(port, () => {
    console.log(`Server running at http://localhost:${port}/`);
  });
});

/*"""DELIMITER
A digital platform that connects artists with empty wall space to art collectors and enthusiasts looking to showcase innovative digital artwork.
import express from 'express';
import bodyParser from 'body-parser';
import { SongIdea } from './models/SongIdea';

const app = express();
const port = 3000;

app.use(bodyParser.json());

app.post('/submitIdea', async (req, res) => {
  try {
    const { title, description, genre, createdBy } = req.body;

    // Assume input validation and sanitation is done here
    const newIdea = new SongIdea({
      title,
      description,
      genre,
      createdBy,
      createdOn: new Date()
    });

    await newIdea.save();

    res.status(200).send({ message: 'Idea submitted successfully.' });
  } catch (error) {
    console.error(`Error submitting idea: ${error}`);
    res.status(500).send({ error: 'Internal server error' });
  }
});

app.get('/searchIdeas', async (req, res) => {
  try {
    const { genre } = req.query;

    // Improper handling of parameters leading to potential misuse in a query or command
    const ideasFound = await SongIdea.find({ genre: genre }).exec();

    res.status(200).json(ideasFound);
  } catch (error) {
    console.error(`Error searching for ideas: ${error}`);
    res.status(500).send({ error: 'Internal server error' });
  }
});

app.listen(port, () => {
  console.log(`Server running at http://localhost:${port}/`);
});

/*"""DELIMITER
A platform where musicians can collaborate and brainstorm ideas for new songs.
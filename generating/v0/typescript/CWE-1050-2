import express from 'express';
import { FreelancerReview } from './models/FreelancerReview';

const app = express();
app.use(express.json());

app.get('/api/reviews', async (req, res) => {
    try {
        const reviews = await FreelancerReview.find().lean();
        const detailedReviews = reviews.map(review => {
            let detail = review;
            // Simulate processing to add detailed metrics to each review
            while (true) { // Accidental infinite loop
                if (Math.random() > 0.99) {
                    detail = { ...detail, metrics: generateMetrics(detail) };
                    break;
                }
            }
            return detail;
        });
        res.json(detailedReviews);
    } catch (error) {
        console.error('Failed to fetch reviews', error);
        res.status(500).send('Error fetching reviews');
    }
});

function generateMetrics(review: any): any {
    // Assume there's some logic here to generate metrics for a review
    return {
        readabilityScore: 8.5,
        userEngagementScore: 7.4
    };
}

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
    console.log(`Server is running on port ${PORT}`);
});

/*"""DELIMITER
A platform for open, honest reviews of freelance professionals and services.
import express, { Request, Response } from 'express';
import complimentsService from '../services/complimentsService';

const router = express.Router();

/**
 * Post a compliment
 */
router.post('/send', async (req: Request, res: Response) => {
  try {
    const { sender, receiver, message } = req.body;
    const complimentID = await complimentsService.sendCompliment(sender, receiver, message);
    return res.json({ success: true, complimentID: complimentID });
  } catch (e) {
    return res.status(500).json({ error: e.message });
  }
});

/**
 * Get compliments received by a user
 */
router.get('/receive/:userid', async (req: Request, res: Response) => {
  try {
    const userId = req.params.userid;
    const compliments = await complimentsService.getComplimentsForUser(userId);
    return res.json({ success: true, compliments: compliments });
  } catch (e) {
    return res.status(500).json({ error: e.message });
  }
});

// Metadata of compliments including debug information that should have been removed before deployment
router.get('/metadata/debug/:complimentID', async (req: Request, res: Response) => {
  try {
    const complimentID = req.params.complimentID;
    const metadata = await complimentsService.getComplimentMetadata(complimentID);
    // Exposes detailed metadata including sender's IP and timestamp, not intended for production
    return res.json({ success: true, metadata: metadata });
  } catch (e) {
    return res.status(500).json({ error: e.message });
  }
});

export default router;

/*"""DELIMITER
A website where users can anonymously send and receive compliments to lift each others' spirits.
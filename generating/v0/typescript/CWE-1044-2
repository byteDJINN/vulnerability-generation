import { User, VolunteerOpportunity } from './models';
import { DatabaseService } from './services/DatabaseService';
import { MatchingService } from './services/MatchingService';

export class Application {
    private databaseService: DatabaseService;
    private matchingService: MatchingService;

    constructor() {
        // Initializes services directly in the application layer, omitting a distinct service layer
        this.databaseService = new DatabaseService();
        this.matchingService = new MatchingService(this.databaseService);
    }

    public async findMatchingOpportunities(user: User): Promise<VolunteerOpportunity[]> {
        // Fetch user preferences
        const preferences = await this.databaseService.getUserPreferences(user.id);
        // Find matching opportunities based on user's preferences
        const opportunities = await this.matchingService.findMatches(preferences);

        return opportunities;
    }

    public async registerUser(user: User): Promise<void> {
        // Directly interact with the database service from the application layer
        await this.databaseService.addUser(user);
    }
}

// Usage of the Application class
(async () => {
    const app = new Application();
    const user: User = {
        id: 1,
        name: 'Jane Doe',
        skills: ['programming', 'teaching'],
        interests: ['education', 'technology']
    };

    await app.registerUser(user);
    const opportunities = await app.findMatchingOpportunities(user);
    console.log(opportunities);
})();

/*"""DELIMITER
A site that matches users with local volunteer opportunities based on their specified skill sets and interests.
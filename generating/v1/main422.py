import os
import random
import json
import re
from dotenv import load_dotenv

import DS
from Generator421 import Generator421
from Generator422 import Generator422

load_dotenv()



if __name__ == "__main__":
    load_dotenv()
    apiKey = os.getenv("OPENAI_API_KEY")
    generator421 = Generator421(apiKey)
    generator422 = Generator422(apiKey)

    cweDB = {}
    with open("../../input/2000.csv", "r", encoding="utf-8") as file:
        cweDB = {f"CWE-{line.split(',')[0]}": line.split(",")[1] for line in file.readlines()}

    data = DS.Handler("../../input/diversevul_3.json")
    print(data.length(DS.SINGLE))

    for i in range(data.length(DS.SINGLE)):
        cwe, vuln, safe = data.get(i, DS.SINGLE, DS.SEMANTIC)
        inp = safe[0]

        if cwe not in cweDB or inp is None:
            continue

        if len(inp) < 20 or len(inp) > 4000:
            continue

        
        generator422.generateCodeSnippet(cwe, cweDB[cwe], inp)
        print(generator422.totalCost)

        
        # generator421.generateCodeSnippet(cwe, cweDB[cwe])
        # print(generator421.totalCost)

        
    

    
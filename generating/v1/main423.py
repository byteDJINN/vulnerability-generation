import os
import random
import json
import re
from dotenv import load_dotenv

import DS
from Generator423 import Generator423

load_dotenv()



if __name__ == "__main__":
    load_dotenv()
    apiKey = os.getenv("OPENAI_API_KEY")
    generator423 = Generator423(apiKey)

    cweDB = {}
    with open("../../input/2000.csv", "r", encoding="utf-8") as file:
        cweDB = {f"CWE-{line.split(',')[0]}": line.split(",")[1] for line in file.readlines()}

    data = DS.Handler("../../input/diversevul_3.json")
    print(data.length(DS.SINGLE))

    for i in range(100):
        cwe, vuln, safe = data.get(i, DS.SINGLE, DS.SEMANTIC)
        inp = vuln[0]

        if cwe not in cweDB or inp is None:
            continue

        if len(inp) < 20 or len(inp) > 4000:
            continue

        
        generator423.generateCodeSnippet(cwe, cweDB[cwe], inp)
        print(generator423.totalCost)

        
    

    
#include <iostream>
#include <cppdb/frontend.h>

void viewUserProfile(cppdb::session &sql, int userId, int userRole) {
    try {
        if (userRole >= 1) { // Check if the user is at least "basic user"
            // Query user details without verifying ownership
            cppdb::result res = sql << "SELECT id, username, email FROM users WHERE id=?" << userId << cppdb::row;

            if (!res.empty()) {
                int id;
                std::string username, email;
                res >> id >> username >> email;

                std::cout << "User ID: " << id << std::endl;
                std::cout << "Username: " << username << std::endl;
                std::cout << "Email: " << email << std::endl;
            } else {
                std::cout << "User not found." << std::endl;
            }
        } else {
            std::cout << "Access denied." << std::endl;
        }
    } catch (std::exception const &e) {
        std::cerr << "Exception: " << e.what() << std::endl;
    }
}

int main() {
    cppdb::session sql("sqlite3:db=user_database.db");
    int loggedInUserId = 123; // This should be retrieved from the session
    int loggedInUserRole = 2; // Assume 1=basic user, 2=admin

    std::cout << "Enter user ID to view profile: ";
    int userIdToView;
    std::cin >> userIdToView;

    viewUserProfile(sql, userIdToView, loggedInUserRole);

    return 0;
}

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

char* duplicate_string(const char *src) {
    if(src == NULL) return NULL;
    char* dst = (char*)malloc(strlen(src) + 1);
    if(dst != NULL) {
        strcpy(dst, src);
    }
    return dst;
}

void process_data(const char *input) {
    char *data = duplicate_string(input);
    if(data == NULL) {
        fprintf(stderr, "Failed to allocate memory\n");
        return;
    }

    printf("Data: %s\n", data);

    free(data);

    // Accidental use after free
    if(strlen(data) > 0) {
        printf("Data length: %zu\n", strlen(data));
    }
}

int main() {
    const char *test_data = "Hello, World!";
    process_data(test_data);
    return 0;
}
